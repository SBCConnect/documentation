############################################
#
#
#     THIS SCRIPT IS FOR MDC
#     CUSTOMER: {@CUSTOMER@}
#
#
############################################
#Script is for the provisioning process of additional MS Teams tenant on *.sbcconnect.com.au in Direct (NON-DERIVED) Trunk (Single-Tenant) setup
#Assumes certificates have been activated and loaded
#Assumes the base Global profiles has been created (LRBT, IPSP, PSP, SMM)
#Assumes Teams tenant Media Bypass=True
#Text indicated by {@xxxx@} to be replaced with correct values


#Variables Used
##############################################################################
#SBC_IP={@SBC_IP@}
#> This is the public IP Address of this SBC
#
#SIG_PORT={@SIG_PORT@}
#> Port used for signaling.
#> This is ALWAYS CONNECT_PORT minus (-) 1 (IE: 5066)
#
#CONNECT_PORT={@CONNECT_PORT@}
#> Port used to be configured in Teams.
#> This is ALWAYS SIP_PORT plus (+) 1 (IE: 5067)
#
#TENANTID={@TENANTID@}
#> This is used as the ID of the customer through out the configuration on the SBC.
#> This is ALWAYS the SIG_PORT number minus (-) 4,000 (IE: 1067)
#
#LOC={@LOC@}
#> This is the SBC ID - IE: MDC or SDC
#
#CARRIER_SIP_TRUNK_RL={@CARRIER_SIP_TRUNK_RL@}
#> This is the sip trunk Routing Label that is used to reach the carrier
#
#
# DOMAIN required for this customer is
# Domain {@TENANTID@}-{@LOC@}.sbcconnect.com.au
# Domain should be an A record to the SBC IP Address: {@SBC_IP@}
#
#
# Mode NON-DERIVED TRUNK


# Configure SIP Domain
##############################################################################
set global sipDomain {@TENANTID@}-{@LOC@}.sbcconnect.com.au
commit

# Configure SMM to Modify Options Message
##############################################################################

set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS state enabled
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS advancedSMM disabled
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS profileType messageManipulation
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 applyMatchHeader one
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 1 message messageTypes response
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 1 message methodTypes options
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 1 message statusCode 200
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 2 header name Contact
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 criterion 2 header hdrInstance all
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 operation regsub
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 from type value
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 from value "<sip:{@TENANTID@}-{@LOC@}.sbcconnect.com.au:{@CONNECT_PORT@};transport=tls>"
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 to type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 to value Contact
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 regexp
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 regexp string .*
set profiles signaling sipAdaptorProfile {@TENANTID@}_OPTIONS rule 1 action 1 regexp matchInstance all
commit

# Configure Zones
##############################################################################

set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE id {@TENANTID@}
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE domainName {@TENANTID@}-{@LOC@}.sbcconnect.com.au
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE messageManipulation outputAdapterProfile {@TENANTID@}_OPTIONS
commit
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE dnsGroup DNS_GROUP_DEFAULT
commit

# Configure an IP Peer
##############################################################################

set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_01 policy sip fqdn sip.pstnhub.microsoft.com fqdnPort 5060
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_02 policy sip fqdn sip2.pstnhub.microsoft.com fqdnPort 5060
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_03 policy sip fqdn sip3.pstnhub.microsoft.com fqdnPort 5060
commit
#
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_01 pathCheck profile TEAMS_OPTIONS
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_01 pathCheck profile TEAMS_OPTIONS hostName sip.pstnhub.microsoft.com hostPort 5060 state enabled
commit

set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_02 pathCheck profile TEAMS_OPTIONS
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_02 pathCheck profile TEAMS_OPTIONS hostName sip2.pstnhub.microsoft.com hostPort 5060 state enabled
commit

set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_03 pathCheck profile TEAMS_OPTIONS
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE ipPeer PEER_A_TEAMS_{@TENANTID@}_03 pathCheck profile TEAMS_OPTIONS hostName sip3.pstnhub.microsoft.com hostPort 5060 state enabled
commit

# Create Signaling Ports
##############################################################################

set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} ipInterfaceGroup EXTERNAL_IPIG
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} ipAddressV4 {@SBC_IP@}
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} portNumber {@SIG_PORT@}
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} dscpValue 26
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} transportProtocolsAllowed sip-tls-tcp
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} tlsProfileName TLS_PROF
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipSigPort {@TENANTID@} state enabled mode inService
commit

# Configure SMM for per Tenant Trunk
##############################################################################

set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT state enabled
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT advancedSMM disabled
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT profileType messageManipulation
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 applyMatchHeader one
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 1 message messageTypes requestAll
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 2 header name From
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 from type value
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 from value {@TENANTID@}-{@LOC@}.sbcconnect.com.au
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 1 action 1 to tokenValue urihostname
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 applyMatchHeader one
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 1 message messageTypes requestAll
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 2 header name P-Preferred-Identity
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 from type value
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 from value {@TENANTID@}-{@LOC@}.sbcconnect.com.au
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 2 action 1 to tokenValue urihostname
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 1 message messageTypes requestAll
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 1 message condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 2 header name Contact
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 from type value
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 from value {@TENANTID@}-{@LOC@}.sbcconnect.com.au
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 3 action 1 to tokenValue urihostname
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 1 message messageTypes request
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 1 message methodTypes invite
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 1 message condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 2 header name Request-Line
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 3 type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 3 parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 3 parameter condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 3 parameter paramType uri
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 criterion 3 parameter name Ribbon
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 operation store
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 paramType uri
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 from type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 from value Ribbon
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 to type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 1 to variableValue var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 operation delete
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 paramType uri
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 from type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 from value Ribbon
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 to type parameter
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 4 action 2 to value Ribbon
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 1 message messageTypes request
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 1 message methodTypes invite
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 1 message condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 2 header name From
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 3 type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 3 variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 3 variable condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 criterion 3 variable variableID var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 from type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 from variableValue var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 5 action 1 to tokenValue urihostname
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 1 message messageTypes request
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 1 message methodTypes invite
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 1 message condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 2 header name Contact
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 3 type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 3 variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 3 variable condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 criterion 3 variable variableID var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 from type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 from variableValue var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 6 action 1 to tokenValue urihostname
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 1 type message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 1 message
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 1 message messageTypes request
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 1 message methodTypes invite
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 1 message condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 2 type header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 2 header
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 2 header name P-Preferred-Identity
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 2 header condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 3 type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 3 variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 3 variable condition exist
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 criterion 3 variable variableID var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 operation modify
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 from
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 from type variable
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 from variableValue var2
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 to
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 to type token
set profiles signaling sipAdaptorProfile {@TENANTID@}_SMM_OUT rule 7 action 1 to tokenValue urihostname
commit


# Configure Per Tenant Trunk Groups
##############################################################################
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG media mediaIpInterfaceGroupName EXTERNAL_IPIG
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling methods update reject
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling rel100Support enabled
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling relayNonInviteRequest enabled
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling honorMaddrParam enabled
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG services dnsSupportType a-only
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG media sdpAttributesSelectiveRelay enabled
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG ingressIpPrefix 52.112.0.0 14
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling messageManipulation inputAdapterProfile TEAMS_SMM_IN
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling messageManipulation outputAdapterProfile {@TENANTID@}_SMM_OUT
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling messageManipulation smmProfileExecution fixedOrder
#IF Media Bypass=TRUE, set iceSupport iceWebrtc
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG services natTraversal iceSupport none
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG state enabled mode inService
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling authentication intChallengeResponse enabled
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG signaling authentication incInternalCredentials enabled
commit
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy sipDomain SIP.PSTNHUB.MICROSOFT.COM
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy signaling ipSignalingProfile EXT_TEAMS_IPSP
#IF Media Bypass=TRUE, set packetServiceProfile EXT_TEAMS_MB_PSP
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy media packetServiceProfile EXT_TEAMS_PSP
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy media toneAndAnnouncementProfile LRBT_PROF
commit
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy digitParameterHandling numberingPlan PSTN_NUM_PLAN
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy country 61 localizationVariant Generic
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy callRouting elementRoutingPriority TG_ERP
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy signaling signalingProfile 5GN_SIG_PROFILE
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy signaling ipSignalingProfile EXT_TEAMS_IPSP
set addressContext default zone EXT_TEAMS_{@TENANTID@}_ZONE sipTrunkGroup EXT_TEAMS_{@TENANTID@}_TG policy featureControlProfile DEFAULT_IP
commit


# Call Routing, Routing Labels
# Setup the routing label
#############################################################################
set global callRouting routingLabel RL_A_TEAMS_{@TENANTID@} action routes routePrioritizationType sequence overflowNOA none overflowNPI none numRoutesPerCall 10


# Call Routing, Routing Labels Routes
# Add routes to the routing label
#############################################################################
set global callRouting routingLabel RL_A_TEAMS_{@TENANTID@} routingLabelRoute 1 routeType trunkGroup trunkGroup EXT_TEAMS_{@TENANTID@}_TG ipPeer PEER_A_TEAMS_{@TENANTID@}_01 inService inService testing normal
set global callRouting routingLabel RL_A_TEAMS_{@TENANTID@} routingLabelRoute 2 routeType trunkGroup trunkGroup EXT_TEAMS_{@TENANTID@}_TG ipPeer PEER_A_TEAMS_{@TENANTID@}_02 inService inService testing normal
set global callRouting routingLabel RL_A_TEAMS_{@TENANTID@} routingLabelRoute 3 routeType trunkGroup trunkGroup EXT_TEAMS_{@TENANTID@}_TG ipPeer PEER_A_TEAMS_{@TENANTID@}_03 inService inService testing normal


# Call Routing Routes
# Create the routes to use the routing labels
#############################################################################
# Call routing TO Teams
set global callRouting route none Sonus_NULL Sonus_NULL standard {@NUMBER@} all all ALL none Sonus_NULL routingLabel RL_A_TEAMS_{@TENANTID@}
# Call routing FROM Teams
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC standard Sonus_NULL Sonus_NULL all all ALL none {@TENANTID@}-{@LOC@}.sbcconnect.com.au routingLabel {@CARRIER_SIP_TRUNK_RL@}
#Call routing for Teams - CALL TRANSFER
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC standard Sonus_NULL Sonus_NULL all all ALL none sip.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC username Sonus_NULL Sonus_NULL all all ALL none sip.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC standard Sonus_NULL Sonus_NULL all all ALL none sip2.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC username Sonus_NULL Sonus_NULL all all ALL none sip2.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC standard Sonus_NULL Sonus_NULL all all ALL none sip3.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
set global callRouting route trunkGroup EXT_TEAMS_{@TENANTID@}_TG VBO-5GN-{@LOC@}-SBC username Sonus_NULL Sonus_NULL all all ALL none sip3.pstnhub.microsoft.com routingLabel RL_A_TEAMS_{@TENANTID@}
commit

